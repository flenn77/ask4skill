#!/bin/bash

# Liste des dossiers à traiter
dirs=(
  frontend
  backend/admin-service
  backend/auth-service
  backend/booking-service
  backend/chat-service
  backend/coach-service
  backend/notification-service
  backend/payment-service
  backend/user-service
)

for dir in "${dirs[@]}"; do
  echo "Traitement de $dir ..."

  # Vérifie que le dossier existe
  if [ -d "$dir" ]; then
    cd "$dir"

    # Supprime node_modules du suivi Git
    git rm -r --cached node_modules 2>/dev/null

    # Ajoute node_modules au .gitignore si ce n'est pas déjà fait
    if ! grep -qx "node_modules" .gitignore 2>/dev/null; then
      echo "node_modules" >> .gitignore
    fi

    # Stage .gitignore
    git add .gitignore

    cd - > /dev/null
  else
    echo "❌ Le dossier $dir n'existe pas, ignoré."
  fi
done

# Commit général
git commit -m "Supprime node_modules de tous les services et ajoute au .gitignore"
git push
